"use strict";var e;!function(e){e.initialize="initialize",e.create_secure_context="create_secure_context",e.generate_diffie_hellman_keys="generate_diffie_hellman_keys",e.compute_diffie_hellman_shared_secret="compute_diffie_hellman_shared_secret"}(e||(e={})),importScripts("../../../build/wasm-cryptopp.js");class t{static _wasmModule;static async load(){await t.rawLoad()}static async rawLoad(){t._wasmModule=await wasmCryptoppJs({locateFile:e=>(console.log(`url: "${e}"`),`/build/${e}`)})}static get(){if(!this._wasmModule)throw new Error("crytpopp wasm module not loaded");return this._wasmModule}}let a=0;const o=new Map,r=e=>{const t=o.get(e);if(!t)throw new Error(`secure context not found: "${e}"`);return t},s=["0x87A8E61DB4B6663CFFBBD19C651959998CEEF608660DD0F2","5D2CEED4435E3B00E00DF8F1D61957D4FAF7DF4561B2AA30","16C3D91134096FAA3BF4296D830E9A7C209E0C6497517ABD","5A8A9D306BCF67ED91F9E6725B4758C022E0B1EF4275BF7B","6C5BFC11D45F9088B941F54EB1E59BB8BC39A0BF12307F5C","4FDB70C581B23F76B63ACAE1CAA6B7902D52526735488A0E","F13C6D9A51BFA4AB3AD8347796524D8EF6A167B5A41825D9","67E144E5140564251CCACB83E6B486F6B3CA3F7971506026","C0B857F689962856DED4010ABD0BE621C3A3960A54E710C3","75F26375D7014103A4B54330C198AF126116D2276E11715F","693877FAD7EF09CADB094AE91E1A1597"].join(""),n=["0x3FB32C9B73134D0B2E77506660EDBD484CA7B18F21EF2054","07F4793A1A0BA12510DBC15077BE463FFF4FED4AAC0BB555","BE3A6C1B0C6B47B1BC3773BF7E8C6F62901228F8C28CBB18","A55AE31341000A650196F931C77A57F2DDF463E5E9EC144B","777DE62AAAB8A8628AC376D282D6ED3864E67982428EBC83","1D14348F6F2F9193B5045AF2767164E1DFC967C1FB3F2E55","A4BD1BFFE83B9C80D052B985D182EA0ADB2A3B7313D3FE14","C8484B1E052588B9B7D2BBD2DF016199ECD06E1557CD0915","B3353BBB64E0EC377FD028370DF92B52C7891428CDC67EB6","184B523D1DB246C32F63078490F00EF8D647D148D4795451","5E2327CFEF98C582664B4C0F6CC41659"].join(""),i=new Map([[e.initialize,async a=>{if(!(t=>t?.type===e.initialize)(a))throw new Error("invalid payload");const o=Date.now();await t.load();const r=Date.now()-o;return console.log(`worker, wasmCryptoppJs wasm module loaded (${r}ms)`),{elapsedTime:r}}],[e.create_secure_context,async r=>{if(!(t=>t?.type===e.create_secure_context)(r))throw new Error("invalid payload");const s=Date.now(),n=(()=>{a+=1;const e=`${a}`,r=t.get();return o.set(e,{diffieHellmanClient:new r.DiffieHellmanClientJs,aesSymmetricCipher:new r.AesSymmetricCipherJs}),e})();return{elapsedTime:Date.now()-s,id:n}}],[e.generate_diffie_hellman_keys,async t=>{if(!(t=>t?.type===e.generate_diffie_hellman_keys)(t))throw new Error("invalid payload");const a=Date.now(),o=r(t.id);var i;o.publicKey=((i=o.diffieHellmanClient).generateKeys(s,"0x8CF83642A709A097B447997640129DA299B1A47D1EB3750BA308B0FE64F5FBD3",n),i.getPublicKeyAsHexStr());return{elapsedTime:Date.now()-a,publicKey:o.publicKey}}],[e.compute_diffie_hellman_shared_secret,async t=>{if(!(t=>t?.type===e.compute_diffie_hellman_shared_secret)(t))throw new Error("invalid payload");const a=Date.now(),o=r(t.id);o.diffieHellmanClient.computeSharedSecretFromHexStr(t.publicKey),o.sharedSecret=o.diffieHellmanClient.getSharedSecretAsHexStr();return{elapsedTime:Date.now()-a,sharedSecret:o.sharedSecret}}]]);self.onmessage=async e=>{console.log("worker: on message"),console.log("type",e.data.type),console.log("message.data",e.data);try{const t=i.get(e.data?.type);if(!t)throw new Error(`unknown strategy "${e.data?.type}"`);const a=await t(e.data);console.log("worker: on reply"),console.log("type",e.data.type),console.log("response",a),self.postMessage({success:!0,response:a})}catch(t){console.log("worker: on reply error"),console.log("type",e.data.type),console.log("response.error",t),self.postMessage({success:!1,response:{error:t}})}};
